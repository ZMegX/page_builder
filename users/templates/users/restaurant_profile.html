{% extends "base.html" %}
{% block title %}Restaurant Profile - Page Builder{% endblock %}
{% load crispy_forms_tags %}
{% load static %}
<link rel="stylesheet" href="{% static 'users/restaurant_profile.css' %}">
{% block extra_css %}
<style>
  #place-picker { width: 100%; }
  .btn-save-custom {
    color: #222 !important;
    border: 1.5px solid #222 !important;
    background: #fff !important;
    border-radius: 0.6rem !important;
    font-size: 1.12rem !important;
    font-weight: 600;
    width: 100%;
    transition: color .2s, background .2s;
  }
  .btn-save-custom:hover, .btn-save-custom:focus {
    color: #fff !important;
    background: #222 !important;
    border: 1.5px solid #222 !important;
  }
</style>
{% endblock %}
{% block content %}
<div class="container py-4">
  <!-- Live Preview Card -->
  <div class="mb-4">
    <div class="card shadow-sm border-0 rounded-4 w-100">
      <div class="card-body d-flex flex-column flex-md-row align-items-center">
        <div class="me-md-4 mb-3 mb-md-0 text-center">
          <img id="previewLogo" src="{{ rp_form.instance.logo.url|default:'https://via.placeholder.com/180x120.png?text=No+Logo' }}" class="img-fluid rounded" style="max-height:120px; object-fit:cover;" alt="Logo preview">
        </div>
        <div class="flex-grow-1">
          <h3 class="fw-bold mb-1">{{ rp_form.instance.name|default:'Restaurant Name' }}</h3>
          <div class="mb-2">
            <span class="badge bg-secondary">{{ rp_form.instance.theme_choice|default:'Default Theme' }}</span>
          </div>
          <div class="mb-2">
            <i class="bi bi-geo-alt me-1"></i>
            {% if saved_addresses and saved_addresses.0.formatted_address %}
              {{ saved_addresses.0.formatted_address }}
            {% else %}
              <span class="text-muted">No address set</span>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Profile Completeness Progress Bar & Checklist -->
  <div class="mb-4">
    <div class="card border-0 shadow-sm rounded-4">
      <div class="card-body">
        {% with logo_ok=rp_form.instance.logo.url|default_if_none:'' address_ok=saved_addresses.0.formatted_address|default_if_none:'' hours_ok=hours_fs.0.open_time.value|default_if_none:'' %}
        {% with completeness=0 %}
          {% if logo_ok %}{% with completeness=completeness|add:33 %}{% endwith %}{% endif %}
          {% if address_ok %}{% with completeness=completeness|add:33 %}{% endwith %}{% endif %}
          {% if hours_ok %}{% with completeness=completeness|add:34 %}{% endwith %}{% endif %}
          <div class="d-flex align-items-center mb-2">
            <span class="fw-bold me-2">Profile Completeness</span>
            <div class="progress flex-grow-1" style="height: 18px;">
              <div class="progress-bar bg-success" role="progressbar" style="width: {{ completeness }}%;" aria-valuenow="{{ completeness }}" aria-valuemin="0" aria-valuemax="100">{{ completeness }}%</div>
            </div>
          </div>
          <ul class="list-inline mb-0">
            <li class="list-inline-item">
              <i class="bi bi-image" style="font-size:1.2em;"></i>
              <span {% if logo_ok %}class="text-success"{% else %}class="text-muted"{% endif %}>Logo {% if logo_ok %}<i class="bi bi-check-circle-fill text-success"></i>{% endif %}</span>
            </li>
            <li class="list-inline-item">
              <i class="bi bi-geo-alt" style="font-size:1.2em;"></i>
              <span {% if address_ok %}class="text-success"{% else %}class="text-muted"{% endif %}>Address {% if address_ok %}<i class="bi bi-check-circle-fill text-success"></i>{% endif %}</span>
            </li>
            <li class="list-inline-item">
              <i class="bi bi-clock" style="font-size:1.2em;"></i>
              <span {% if hours_ok %}class="text-success"{% else %}class="text-muted"{% endif %}>Opening Hours {% if hours_ok %}<i class="bi bi-check-circle-fill text-success"></i>{% endif %}</span>
            </li>
          </ul>
        {% endwith %}
        {% endwith %}
      </div>
    </div>
  </div>
  <form id="restaurant-profile-form" method="POST" enctype="multipart/form-data" autocomplete="off">
    {% csrf_token %}
    <ul class="nav nav-tabs mb-4" id="profileTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">
          <i class="bi bi-info-circle me-1"></i> Details
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="social-tab" data-bs-toggle="tab" data-bs-target="#social" type="button" role="tab" aria-controls="social" aria-selected="false">
          <i class="bi bi-share me-1"></i> Social Links
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="hours-tab" data-bs-toggle="tab" data-bs-target="#hours" type="button" role="tab" aria-controls="hours" aria-selected="false">
          <i class="bi bi-clock me-1"></i> Opening Hours
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="logo-tab" data-bs-toggle="tab" data-bs-target="#logo" type="button" role="tab" aria-controls="logo" aria-selected="false">
          <i class="bi bi-image me-1"></i> Logo
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="location-tab" data-bs-toggle="tab" data-bs-target="#location" type="button" role="tab" aria-controls="location" aria-selected="false">
          <i class="bi bi-geo-alt me-1"></i> Location
        </button>
      </li>
    </ul>
    <div class="tab-content" id="profileTabContent">
      <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
        <div class="card shadow-sm border-0 rounded-4 mb-4">
          <div class="card-header bg-white border-bottom-0 rounded-top-4">
            <h5 class="mb-0 py-2 fs-5 text-primary-emphasis"><i class="bi bi-info-circle me-2"></i> Restaurant Details</h5>
          </div>
          <div class="card-body">
            {% if rp_form.errors %}
              <div class="alert alert-danger">
                {{ rp_form.non_field_errors }}
                {% for field in rp_form %}
                  {% for error in field.errors %}
                    <div>{{ field.label }}: {{ error }}</div>
                  {% endfor %}
                {% endfor %}
              </div>
            {% endif %}
            <div class="mb-3">
              <label class="form-label">Theme
                <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip" title="Choose a color theme for your restaurant page. You can preview each theme below."></i>
              </label>
              {% for value, label in rp_form.theme_choice.field.choices %}
                <label style="display:block; margin-bottom:1em;">
                  <input type="radio" name="theme_choice" value="{{ value }}"
                    {% if rp_form.theme_choice.value == value %}checked{% endif %}>
                  <img src="{% static 'themes/previews/' %}{{ value }}-preview.png"
                      alt="{{ label }} preview"
                      style="height:60px; vertical-align:middle; margin-right:10px;">
                  {{ label }}
                </label>
              {% endfor %}
            </div>
            {% for field in rp_form %}
              {% if field.name != "logo" and field.name != "theme_choice" %}
                <div class="mb-3">
                  {{ field|as_crispy_field }}
                  {% if field.errors %}
                    <div class="text-danger small mt-1">
                      {% for error in field.errors %}
                        <span class="badge bg-danger">{{ error }}</span>
                      {% endfor %}
                    </div>
                  {% elif field.value and not field.errors %}
                    <div class="text-success small mt-1">
                      <span class="badge bg-success">Looks good!</span>
                    </div>
                  {% endif %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="social" role="tabpanel" aria-labelledby="social-tab">
        <div class="card shadow-sm border-0 rounded-4 mb-4">
          <div class="card-header bg-white border-bottom-0 rounded-top-4">
            <h5 class="mb-0 py-2 fs-5 text-primary-emphasis"><i class="bi bi-share me-2"></i> Social Links</h5>
          </div>
          <div class="card-body">
            {{ social_fs.management_form }}
            {% if social_fs.non_form_errors %}
              <div class="alert alert-danger">
                {{ social_fs.non_form_errors }}
              </div>
            {% endif %}
            {% for form in social_fs %}
              {{ form.id }}
              {% if form.errors %}
                <div class="alert alert-danger">
                  {% for field in form %}
                    {% for error in field.errors %}
                      <div>{{ field.label }}: {{ error }}</div>
                    {% endfor %}
                  {% endfor %}
                </div>
              {% endif %}
              <div class="row g-3 mb-2 align-items-center">
                <div class="col-md-5">
                  {{ form.name|as_crispy_field }}
                  {% if form.name.errors %}
                    <div class="text-danger small mt-1">
                      {% for error in form.name.errors %}
                        <span class="badge bg-danger">{{ error }}</span>
                      {% endfor %}
                    </div>
                  {% elif form.name.value and not form.name.errors %}
                    <div class="text-success small mt-1">
                      <span class="badge bg-success">Looks good!</span>
                    </div>
                  {% endif %}
                </div>
                <div class="col-md-7 d-flex align-items-center gap-2">
                  <span class="social-icon" data-url="{{ form.url.value|default:'' }}"></span>
                  {{ form.url|as_crispy_field }}
                  {% if form.url.errors %}
                    <div class="text-danger small mt-1">
                      {% for error in form.url.errors %}
                        <span class="badge bg-danger">{{ error }}</span>
                      {% endfor %}
                    </div>
                  {% elif form.url.value and not form.url.errors %}
                    <div class="text-success small mt-1">
                      <span class="badge bg-success">Looks good!</span>
                    </div>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="hours" role="tabpanel" aria-labelledby="hours-tab">
        <div class="card shadow-sm border-0 rounded-4 mb-4">
          <div class="card-header bg-white border-bottom-0 rounded-top-4 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 py-2 fs-5 text-primary-emphasis"><i class="bi bi-clock me-2"></i> Opening Hours</h5>
            <button type="button" class="btn btn-outline-secondary btn-sm" id="copy-hours-btn">
              <i class="bi bi-clipboard me-1"></i> Copy to All Days
            </button>
          </div>
          <div class="card-body">
            {{ hours_fs.management_form }}
            {% if hours_fs.non_form_errors %}
              <div class="alert alert-danger">
                {{ hours_fs.non_form_errors }}
              </div>
            {% endif %}
            <div class="table-responsive">
              <table class="table table-bordered align-middle text-center">
                <thead class="table-light">
                  <tr>
                    <th>Day</th>
                    <th>Open Time</th>
                    <th>Close Time</th>
                    <th>Quick Set</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for form in hours_fs %}
                  {% with day=form.day_of_week.value|default:'' %}
                  <tr class="hours-row {% if day|lower == now|date:'l'|lower %}table-info{% endif %}">
                    <td class="fw-bold">
                      {{ form.day_of_week|as_crispy_field }}
                    </td>
                    <td>
                      <input type="time" name="{{ form.open_time.html_name }}" id="{{ form.open_time.id_for_label }}" class="form-control open-time-input" value="{{ form.open_time.value|default:'' }}" {% if form.is_closed.value %}style="display:none;"{% endif %}>
                    </td>
                    <td>
                      <input type="time" name="{{ form.close_time.html_name }}" id="{{ form.close_time.id_for_label }}" class="form-control close-time-input" value="{{ form.close_time.value|default:'' }}" {% if form.is_closed.value %}style="display:none;"{% endif %}>
                    </td>
                    <td>
                      <div class="d-flex gap-1 justify-content-center align-items-center">
                        <button type="button" class="btn btn-outline-secondary btn-sm set-closed-btn" title="Set Closed">Closed</button>
                        <button type="button" class="btn btn-outline-secondary btn-sm set-24h-btn" title="Set 24h">24h</button>
                        <div class="form-check ms-2">
                          <input class="form-check-input is-closed-checkbox" type="checkbox" name="{{ form.is_closed.html_name }}" id="{{ form.is_closed.id_for_label }}" value="true" {% if form.is_closed.value %}checked{% endif %}>
                          <label class="form-check-label" for="{{ form.is_closed.id_for_label }}">Closed</label>
                        </div>
                      </div>
                    </td>
                    <td>
                      <button type="button" class="btn btn-outline-danger btn-sm clear-hours-btn" title="Clear this row">
                        <i class="bi bi-x-circle"></i> Clear
                      </button>
                    </td>
                  </tr>
                  {% endwith %}
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="logo" role="tabpanel" aria-labelledby="logo-tab">
        <div class="card shadow-sm border-0 rounded-4 mb-4">
          <div class="card-header bg-white border-bottom-0 rounded-top-4">
            <h5 class="mb-0 py-2 fs-5 text-primary-emphasis"><i class="bi bi-image me-2"></i> Logo</h5>
          </div>
          <div class="card-body text-center">
            <img id="logoPreview" src="{{ rp_form.instance.logo.url|default:'https://via.placeholder.com/300x200.png?text=No+Logo' }}" class="img-fluid rounded mb-3" style="max-height: 250px; object-fit: cover;" alt="Logo preview">
            <div class="mb-2">
              <i class="bi bi-info-circle text-primary" data-bs-toggle="tooltip" title="Recommended logo size: 300x200px. Supported formats: PNG, JPG. Transparent backgrounds look best."></i>
            </div>
            {{ rp_form.logo|as_crispy_field }}
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="location" role="tabpanel" aria-labelledby="location-tab">
        <div class="card shadow-sm border-0 rounded-4 mb-4">
          <div class="card-header bg-white border-bottom-0 rounded-top-4">
            <h5 class="mb-0 py-2 fs-5 text-primary-emphasis"><i class="bi bi-geo-alt me-2"></i>Restaurant Location</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label for="new-address-input" class="form-label">Add New Address</label>
              <i class="bi bi-info-circle text-primary ms-1" data-bs-toggle="tooltip" title="Start typing and select an address from the dropdown. Only valid addresses are accepted."></i>
              <input type="text" id="new-address-input" class="form-control" placeholder="Type address or place">
              <button type="button" class="btn btn-outline-primary mt-2" id="add-address-btn">
                <i class="bi bi-geo-alt"></i> Add Address
              </button>
              <div id="feedback-message" class="mt-2 small" style="min-height: 20px;"></div>
            </div>
            <hr>
            <h6 class="text-muted mb-2">Saved Locations</h6>
            <ul id="address-list" class="list-group list-group-flush">
              {% if saved_addresses %}
                {% for address in saved_addresses %}
                  <li id="address-{{ address.id }}" class="list-group-item d-flex justify-content-between align-items-center">
                    <span class="flex-grow-1 address-text">{{ address.formatted_address }}</span>
                    <input type="text" class="form-control d-none address-edit-input" value="{{ address.formatted_address }}" style="max-width: 60%;">
                    <button type="button" class="btn btn-outline-secondary btn-sm edit-address-btn ms-2" data-address-id="{{ address.id }}">
                      <i class="bi bi-pencil"></i>
                    </button>
                    <button type="button" class="btn btn-outline-success btn-sm save-address-btn ms-2 d-none" data-address-id="{{ address.id }}">
                      <i class="bi bi-check"></i>
                    </button>
                    <button type="button" class="btn btn-outline-danger btn-sm delete-address-btn ms-2" data-address-id="{{ address.id }}">
                      <i class="bi bi-trash"></i>
                    </button>
                  </li>
                {% endfor %}
              {% else %}
                <li id="no-addresses-alert" class="list-group-item text-muted">No addresses saved yet.</li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class="card shadow-sm border-0 rounded-4 mt-4">
      <div class="card-body text-end">
        <button type="submit" class="btn btn-primary btn-lg px-4 d-none d-md-inline">
          <i class="bi bi-save me-2"></i> Save All Profile Changes
        </button>
      </div>
    </div>
    <!-- Sticky Save Button -->
    <button type="submit" form="restaurant-profile-form" class="btn btn-primary btn-lg px-4 position-fixed" style="bottom:32px; right:32px; z-index:1050; box-shadow:0 4px 16px rgba(0,0,0,0.12);">
      <i class="bi bi-save me-2"></i> Save
    </button>
  </form>
</div>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/restaurant_profile.js' %}"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    var errorAlert = document.querySelector('.alert-danger');
    if (errorAlert) {
      var errorText = errorAlert.innerText.trim();
      if (errorText) {
        alert('Form Error:\n' + errorText);
      }
    }
  });
  </script>
<script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=places"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  // logo preview
  const logoInput = document.querySelector('[name="logo"]');
  if (logoInput) {
    logoInput.addEventListener('change', function(event) {
      const preview = document.getElementById('logoPreview');
      const file = event.target.files[0];
      if (file) {
        preview.src = URL.createObjectURL(file);
      }
    });
  }

  // --- Address Management ---
  const feedbackMessage = document.getElementById('feedback-message');
  const addressList = document.getElementById('address-list');
  const newAddressInput = document.getElementById('new-address-input');
  const addAddressBtn = document.getElementById('add-address-btn');

  // Google Places Autocomplete for new address input
  let autocomplete = null;
  let selectedPlace = null;
  if (window.google && window.google.maps && window.google.maps.places) {
    autocomplete = new google.maps.places.Autocomplete(newAddressInput);
    autocomplete.addListener('place_changed', function() {
      const place = autocomplete.getPlace();
      if (!place.formatted_address || !place.geometry || !place.geometry.location) {
        feedbackMessage.innerHTML = '<span class="text-danger">Please select a valid address from the dropdown.</span>';
        newAddressInput.classList.add('is-invalid');
        selectedPlace = null;
        return;
      }
      newAddressInput.classList.remove('is-invalid');
      newAddressInput.value = place.formatted_address;
      selectedPlace = place;
    });
  }

  addAddressBtn.addEventListener('click', async function() {
    const addressValue = newAddressInput.value.trim();
    if (!addressValue || !selectedPlace || !selectedPlace.geometry || !selectedPlace.geometry.location) {
      feedbackMessage.innerHTML = '<span class="text-danger">Please select a valid address from the dropdown.</span>';
      newAddressInput.classList.add('is-invalid');
      return;
    }
    feedbackMessage.innerHTML = '<span class="text-primary">Saving address...</span>';
    try {
      const response = await fetch("{% url 'locations:address-list-create' %}", {
        method: "POST",
        headers: {"Content-Type": "application/json", "X-CSRFToken": csrftoken},
        body: JSON.stringify({
          formatted_address: addressValue,
          latitude: selectedPlace.geometry.location.lat(),
          longitude: selectedPlace.geometry.location.lng()
        })
      });
      if (response.ok) {
        const newAddress = await response.json();
        addAddressToList(newAddress);
        feedbackMessage.innerHTML = '<span class="text-success">Address added!</span>';
        newAddressInput.value = '';
        selectedPlace = null;
      } else {
        const errorText = await response.text();
        feedbackMessage.innerHTML = `<span class="text-danger">Error: ${errorText}</span>`;
      }
    } catch (error) {
      feedbackMessage.innerHTML = '<span class="text-danger">A network error occurred.</span>';
      console.error("Save address error:", error);
    }
  });

  function addAddressToList(address) {
    document.getElementById('no-addresses-alert')?.remove();
    const li = document.createElement('li');
    li.id = `address-${address.id}`;
    li.className = 'list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML = `
      <span class="flex-grow-1 address-text">${address.formatted_address}</span>
      <input type="text" class="form-control d-none address-edit-input" value="${address.formatted_address}" style="max-width: 60%;">
      <button type="button" class="btn btn-outline-secondary btn-sm edit-address-btn ms-2" data-address-id="${address.id}">
        <i class="bi bi-pencil"></i>
      </button>
      <button type="button" class="btn btn-outline-success btn-sm save-address-btn ms-2 d-none" data-address-id="${address.id}">
        <i class="bi bi-check"></i>
      </button>
      <button type="button" class="btn btn-outline-danger btn-sm delete-address-btn ms-2" data-address-id="${address.id}">
        <i class="bi bi-trash"></i>
      </button>
    `;
    addressList.appendChild(li);
    new bootstrap.Tooltip(li.querySelector('.delete-address-btn'));
  }

  addressList.addEventListener('click', async function(event) {
    // Delete address
    const deleteButton = event.target.closest('.delete-address-btn');
    if (deleteButton) {
      const addressId = deleteButton.dataset.addressId;
      const url = `/locations/api/addresses/${addressId}/delete/`;
      if (!confirm('Are you sure you want to delete this address?')) return;
      try {
        const response = await fetch(url, {
          method: 'DELETE',
          headers: {'X-CSRFToken': csrftoken}
        });
        if (response.ok) {
          document.getElementById(`address-${addressId}`).remove();
          if (addressList.children.length === 0) {
              addressList.innerHTML = '<li id="no-addresses-alert" class="list-group-item text-muted">No addresses saved yet.</li>';
          }
        } else {
          const errorData = await response.json();
          alert(`Failed to delete address: ${errorData.message || 'Unknown error'}`);
        }
      } catch (error) {
        console.error('Delete address error:', error);
        alert('A network error occurred while trying to delete the address.');
      }
      return;
    }
    // Edit address
    const editButton = event.target.closest('.edit-address-btn');
    if (editButton) {
      const li = editButton.closest('li');
      li.querySelector('.address-text').classList.add('d-none');
      li.querySelector('.address-edit-input').classList.remove('d-none');
      li.querySelector('.save-address-btn').classList.remove('d-none');
      editButton.classList.add('d-none');
      return;
    }
    // Save address
    const saveButton = event.target.closest('.save-address-btn');
    if (saveButton) {
      const addressId = saveButton.dataset.addressId;
      const li = saveButton.closest('li');
      const newAddress = li.querySelector('.address-edit-input').value;
      if (!newAddress.trim()) {
        alert('Address cannot be empty.');
        return;
      }
      try {
        const response = await fetch(`/locations/api/addresses/${addressId}/update/`, {
          method: 'PATCH',
          headers: {'Content-Type': 'application/json', 'X-CSRFToken': csrftoken},
          body: JSON.stringify({ formatted_address: newAddress })
        });
        if (response.ok) {
          li.querySelector('.address-text').textContent = newAddress;
          li.querySelector('.address-text').classList.remove('d-none');
          li.querySelector('.address-edit-input').classList.add('d-none');
          saveButton.classList.add('d-none');
          li.querySelector('.edit-address-btn').classList.remove('d-none');
        } else {
          const errorData = await response.json();
          alert(`Failed to update address: ${errorData.message || 'Unknown error'}`);
        }
      } catch (error) {
        console.error('Update address error:', error);
        alert('A network error occurred while trying to update the address.');
      }
      return;
    }
  });

  const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl)
  })

  // --- Social Links Icon Auto-detect ---
  function getSocialIcon(url) {
    if (!url) return '<i class="bi bi-link-45deg text-secondary"></i>';
    url = url.toLowerCase();
    if (url.includes('facebook.com')) return '<i class="bi bi-facebook text-primary"></i>';
    if (url.includes('twitter.com') || url.includes('x.com')) return '<i class="bi bi-twitter-x text-dark"></i>';
    if (url.includes('instagram.com')) return '<i class="bi bi-instagram text-danger"></i>';
    if (url.includes('linkedin.com')) return '<i class="bi bi-linkedin text-primary"></i>';
    if (url.includes('youtube.com')) return '<i class="bi bi-youtube text-danger"></i>';
    if (url.includes('tiktok.com')) return '<i class="bi bi-tiktok text-dark"></i>';
    if (url.includes('pinterest.com')) return '<i class="bi bi-pinterest text-danger"></i>';
    if (url.includes('whatsapp.com')) return '<i class="bi bi-whatsapp text-success"></i>';
    if (url.includes('threads.net')) return '<i class="bi bi-threads text-dark"></i>';
    if (url.includes('snapchat.com')) return '<i class="bi bi-snapchat text-warning"></i>';
    return '<i class="bi bi-link-45deg text-secondary"></i>';
  }

  document.querySelectorAll('.social-icon').forEach(function(el) {
    const url = el.getAttribute('data-url');
    el.innerHTML = getSocialIcon(url);
  });
});
</script>
{% endblock %}