{% extends "base.html" %}
{% load static %}
{% block title %}{{ profile.name }} — Restaurant{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="card shadow-lg border-0 rounded-4 mb-5 bg-light fade-in-section">
    <div class="row g-0 align-items-stretch">
      <!-- Left Column: Restaurant Details -->
      <div class="col-lg-6 d-flex flex-column justify-content-between p-4">
        <div>
          <div class="d-flex align-items-center mb-3">
            {% if profile.logo %}
              <img src="{{ profile.logo.url }}" class="img-fluid rounded shadow-sm me-3 logo-animate" style="max-height: 80px; border: 4px solid #fff;" alt="{{ profile.name }} logo">
            {% endif %}
            <div>
              <h1 class="display-6 mb-0">{{ profile.name }}</h1>
              {% if status.open_now %}
                <span class="badge text-bg-success ms-auto">Open now</span>
              {% else %}
                <span class="badge text-bg-secondary ms-auto">Closed</span>
              {% endif %}
            </div>
          </div>
          <div class="mb-2 fade-in-section">
            {% if profile.cuisine_type %}
              <div class="mb-2">
                <i class="bi bi-egg-fried me-2 text-muted"></i>
                <strong>Cuisine:</strong> {{ profile.cuisine_type }}
              </div>
            {% endif %}
            {% if profile.phone_number %}
              <div class="mb-2">
                <i class="bi bi-telephone me-2 text-muted"></i>
                <strong>Phone:</strong> <a href="tel:{{ profile.phone_number }}">{{ profile.phone_number }}</a>
              </div>
            {% endif %}
            {% if status.today_hours %}
              <div class="mb-2">
                <i class="bi bi-clock me-2 text-muted"></i>
                <strong>Today's hours:</strong>
                {% for oh in status.today_hours %}
                  {{ oh.open_time|time:"g:i A" }}–{{ oh.close_time|time:"g:i A" }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              </div>
            {% endif %}
            {% if address.formatted_address %}
              <div class="mb-2">
                <i class="bi bi-geo-alt me-2 text-muted"></i>
                <strong>Address:</strong> {{ address.formatted_address }}
                <div>
                  <a class="small" target="_blank" rel="noopener"
                     href="https://www.google.com/maps/search/?api=1&query={{ address.formatted_address|urlencode }}">
                     Get directions
                  </a>
                </div>
              </div>
            {% endif %}
          </div>
          <div class="my-4">
            {% if slug %}
              <a href="{% url 'webpage_restaurant_site:menu' slug=slug %}" class="btn btn-primary btn-lg w-100">
                <i class="bi bi-book-fill me-2"></i>View Menus
              </a>
            {% else %}
              <span class="btn btn-secondary btn-lg w-100 disabled">No menu available</span>
          </div>
          {% if profile.social_links.all %}
            <section class="mt-auto pt-3 fade-in-section">
              <strong>Follow us:</strong>
              <div class="d-flex gap-2 mt-2 flex-wrap">
                {% for sl in profile.social_links.all %}
                  <a class="btn btn-sm btn-outline-secondary" href="{{ sl.url }}" target="_blank" rel="noopener">
                    <i class="bi bi-box-arrow-up-right me-1"></i>{{ sl.name }}
                  </a>
                {% endfor %}
              </div>
            </section>
          {% endif %}
        </div>
      </div>
      <!-- Right Column: Map -->
      <div class="col-lg-6 p-0">
        <div class="h-100 w-100 d-flex align-items-center justify-content-center">
          {% if address and map_center.lat and map_center.lng and GOOGLE_MAPS_API_KEY %}
            <div id="map" class="rounded w-100" style="height: 320px;"></div>
          {% else %}
            <div class="p-5 h-100 d-flex justify-content-center align-items-center text-center text-muted">
              <div>
                <i class="bi bi-geo-alt" style="font-size: 2.5rem;"></i>
                <div class="mt-2">No address has been set for this restaurant.</div>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/landing_animations.js' %}" defer></script>
{% if address and map_center.lat and map_center.lng and GOOGLE_MAPS_API_KEY %}
<script>
  // This function will be called by the Google Maps API script
  function initMap() {
    // The location of the restaurant
    const location = { lat: {{ map_center.lat }}, lng: {{ map_center.lng }} };
    
    // The map, centered at the restaurant's location
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 15,
      center: location,
      mapTypeControl: false,
      streetViewControl: false,
    });
    
    // The marker, positioned at the restaurant's location
    const marker = new google.maps.Marker({
      position: location,
      map: map,
      title: "{{ profile.name|escapejs }}"
    });
  }
</script>
<!-- Async script to load the Google Maps API and call initMap -->
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap">
</script>
{% endif %}
{% endblock %}