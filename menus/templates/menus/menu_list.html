{% extends "base.html" %}
{% load static %}
{% load cloudinary %}

{% block title %}My Menus - {{ restaurant.name }}{% endblock %}
{% block extra_css %}
<style>
  .minimal-card {
    border-radius: 10px;
  }
  .minimal-items {
    font-size: 0.95em;
  }
</style>
{% endblock %}
{% block content %}
<div class="container py-4">
  <div class="row mb-4 align-items-center">
    <div class="col-md-6 col-12">
      <input type="text" class="form-control" placeholder="Search menus...">
    </div>
    <div class="col-md-6 col-12 text-md-end mt-2 mt-md-0 d-flex gap-2 justify-content-md-end">
      {% if restaurant.slug %}
        <a href="{% url 'webpage_restaurant_site:landing' slug=restaurant.slug %}" target="_blank" rel="noopener" class="btn btn-outline-success">
          <i class="bi bi-eye me-1"></i> View Website
        </a>
      {% endif %}
      <a href="/menu-editor/create" class="btn btn-primary">
        <i class="bi bi-plus-lg me-1"></i> Create Menu
      </a>
    </div>
  </div>
  <div class="row">
    {% for menu in menus %}
    <div class="col-md-6 col-lg-4 mb-3">
      <div class="card shadow-sm border-0 minimal-card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">{{ menu.name }}</h5>
            <span class="badge {% if menu.is_active %}bg-success{% else %}bg-secondary{% endif %} px-3 py-2">
              {% if menu.is_active %}Active{% else %}Inactive{% endif %}
            </span>
          </div>
          <p class="text-muted mb-2 minimal-items">
            {{ menu.items.count }} items
            <span class="d-block mt-2">
              {% for item in menu.items.all|slice:":3" %}
                {% if item.image %}
                  <img src="{% cloudinary_url item.image.public_id width=40 height=40 crop='fill' gravity='auto' %}" alt="{{ item.name }}" class="img-fluid rounded me-1" style="max-width:40px; max-height:40px;">
                {% endif %}
              {% endfor %}
              {% if menu.items.count > 3 %}
                <span class="text-muted small">+{{ menu.items.count|add:"-3" }} more</span>
              {% endif %}
            </span>
          </p>
            <div class="d-flex gap-2">
              <a href="/menu-editor/{{ menu.pk }}/" class="btn btn-outline-primary btn-sm flex-grow-1">View/Edit</a>
              <form method="post" action="{% url 'menus:menu_toggle_status' menu.pk %}">
                {% csrf_token %}
                {% if menu.is_active %}
                  <button type="submit" class="btn btn-outline-warning btn-sm">Deactivate</button>
                {% else %}
                  <button type="submit" class="btn btn-outline-success btn-sm">Activate</button>
                {% endif %}
              </form>
              <form method="post" action="{% url 'menus:delete_menu' menu.pk %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
              </form>
            </div>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="col-12 text-center py-5">
      <p class="lead mb-4">No menus yet. Create your first menu to get started.</p>
      <a href="/menu-editor/create" class="btn btn-primary">Create Menu</a>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}