
{% extends "base.html" %}
{% load static %}
{% block title %}Create Menu{% endblock %}

{% block extra_css %}
<style>
  .minimal-card {
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.07);
  }
  .minimal-items {
    font-size: 0.95em;
  }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-lg-4 mb-4">
      {% include 'partials/restaurant_profile_card.html' %}
      <div class="card shadow border-0 minimal-card mt-3">
        <div class="card-header bg-info text-white rounded-top-4">
          <h6 class="mb-0"><i class="bi bi-graph-up me-2"></i>Quick Stats</h6>
        </div>
        <div class="card-body minimal-items">
          <div class="d-flex justify-content-between">
            <span>Total Menus:</span>
            <span class="fw-bold">{{ user_menus_count }}</span>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-8">
      <div class="card shadow-sm border-0 minimal-card">
        <div class="card-body">
          <h1 class="mb-4 h4">Create Menu</h1>
          <form method="post" enctype="multipart/form-data" id="menuForm" class="needs-validation" novalidate autocomplete="off">
            {% csrf_token %}
            <ul class="nav nav-tabs mb-3" id="menuTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="true">Menu Details</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="items-tab" data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab" aria-controls="items" aria-selected="false">Menu Items</button>
              </li>
            </ul>
            <div class="tab-content" id="menuTabContent">
              <div class="tab-pane fade show active" id="details" role="tabpanel" aria-labelledby="details-tab">
                <div class="mb-3">
                  {% for field in form.visible_fields %}
                    <div class="form-floating mb-3">
                      {{ field }}
                      <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                      {% if field.errors %}
                        <div class="invalid-feedback d-block">{{ field.errors|striptags }}</div>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              </div>
              <div class="tab-pane fade" id="items" role="tabpanel" aria-labelledby="items-tab">
                <h2 class="mt-4 h6">Menu Items</h2>
                {{ formset.management_form }}
                {% if formset.non_form_errors %}
                  <div class="alert alert-danger">
                    {{ formset.non_form_errors }}
                  </div>
                {% endif %}
                <div class="table-responsive">
                  <table class="table table-bordered align-middle" id="menuItemsTable">
                    <thead class="table-light">
                      <tr>
                        <th>Section</th>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Ingredients</th>
                        <th>Image</th>
                        <th>Delete</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for form in formset %}
                        <tr class="menu-form-row">
                          <td>{{ form.section }}</td>
                          <td>{{ form.name }}</td>
                          <td>{{ form.price }}</td>
                          <td>{{ form.ingredients }}</td>
                          <td>{{ form.image }}</td>
                          <td class="text-center">
                            {% if form.instance.pk %}
                              {{ form.DELETE }}
                            {% else %}
                              <button type="button" class="btn btn-danger btn-sm remove-row" title="Remove row">&times;</button>
                            {% endif %}
                            {% if form.instance.pk %}{{ form.id }}{% endif %}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
                <button type="button" id="addRowBtn" class="btn btn-outline-secondary mb-3">Add Item</button>
              </div>
            </div>
            <br>
            <button type="submit" class="btn btn-primary">Save Menu</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}