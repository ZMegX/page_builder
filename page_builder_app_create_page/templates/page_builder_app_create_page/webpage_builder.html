{% extends "base.html" %}
{% load widget_tweaks %}
{% load static %}
{% block content %}
<div class="container py-5">
  <h2 class="mb-4">Build your page: <span class="text-primary">{{ template.name }}</span></h2>
  <form method="post" enctype="multipart/form-data" id="builder-form">
    {% csrf_token %}
    <!-- TITLE -->
    <div class="mb-3">
      <label class="form-label fw-semibold">{{ form.title.label }}</label>
      {{ form.title|add_class:"form-control form-control-lg" }}
      {% for error in form.title.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
    </div>
    <!-- DESCRIPTION -->
    <div class="mb-3">
      <label class="form-label fw-semibold">{{ form.description.label }}</label>
      {{ form.description|add_class:"form-control" }}
      {% for error in form.description.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
    </div>
    <!-- COVER IMAGE -->
    <div class="mb-3">
      <label class="form-label fw-semibold">{{ form.cover_image.label }}</label>
      {{ form.cover_image|add_class:"form-control" }}
      {% for error in form.cover_image.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
    </div>
    <!-- ADVANCED OPTIONS -->
    <div class="form-check form-switch mb-3">
      <input class="form-check-input" type="checkbox" id="toggle-advanced">
      <label class="form-check-label" for="toggle-advanced">Show Advanced Options</label>
    </div>
    <div id="advanced-form" style="display:none;">
      <div class="mb-3">{{ form.seo_title|add_class:"form-control" }}</div>
      <div class="mb-3">{{ form.seo_description|add_class:"form-control" }}</div>
      <div class="mb-3">{{ form.layout_style|add_class:"form-select" }}</div>
      <div class="mb-3">{{ form.published|add_class:"form-check-input ms-2" }}</div>
    </div>
    <!-- COMPONENTS -->
    <h5 class="mt-4">Page Components</h5>
    <div id="components-list">
      {{ formset.management_form }}
      {% for f in formset %}
      <div class="card p-3 mb-3 component-form" data-index="{{ forloop.counter0 }}">
        <div class="row g-2">
          <div class="col-md-5">{{ f.type|add_class:"form-select" }}</div>
          <div class="col-md-6">{{ f.content|add_class:"form-control" }}</div>
          <div class="col-md-1 d-flex align-items-end">
            <button type="button" class="btn btn-outline-danger btn-remove-component">Remove</button>
          </div>
        </div>
        <!-- Menu item fields -->
        <div class="menu-item-fields mt-3" style="display:none;">
          <div class="row g-2">
            <div class="col-md-4">{{ f.item_name|add_class:"form-control" }}</div>
            <div class="col-md-4">{{ f.item_price|add_class:"form-control" }}</div>
            <div class="col-md-4">{{ f.item_photo|add_class:"form-control" }}</div>
          </div>
        </div>
        <!-- Advanced component fields -->
        <div class="advanced-component-fields mt-3" style="display:none;">
          <div class="row g-2">
            <div class="col">{{ f.extra_options|add_class:"form-control" }}</div>
            <div class="col">{{ f.visibility|add_class:"form-select" }}</div>
          </div>
        </div>
        {{ f.DELETE }}
      </div>
      {% endfor %}
    </div>
    <button type="button" id="add-component-btn" class="btn btn-outline-primary mb-4">Add Component</button>
    <!-- ADDRESS & MAP -->
    <div class="mb-4">
      <label for="id_address" class="form-label fw-semibold">Restaurant Address</label>
      {{ form.address|add_class:"form-control" }}
      {{ form.latitude }}
      {{ form.longitude }}
      <div id="map" style="height: 300px; margin-top: 10px;" class="rounded shadow-sm"></div>
    </div>

    <button class="btn btn-success">Save Page</button>
  </form>
</div>
{% endblock %}
<!-- SCRIPTS -->
{% block extra_css %}
<link rel="stylesheet" href="{% static 'page_builder_app_create_page/webpage_builder.css' %}">
{% endblock %}
{% block extra_js %}
<script src="{% static 'js/webpageBuilder.js' %}"></script>
{% endblock %}
